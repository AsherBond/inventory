<?xml version="1.0" encoding="UTF-8"?>
<!--
 /**
  * Copyright Â© Magento, Inc. All rights reserved.
  * See COPYING.txt for license details.
  */
-->
<tests xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:noNamespaceSchemaLocation="../../../../../../../dev/tests/acceptance/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Test/etc/testSchema.xsd">
    <test name="AdminStockCannotBeDeletedOnStockPageWhenSalesChannelIsAssignedTest">
        <annotations>
            <features value="Multi-Source Inventory"/>
            <stories value="Cannot Delete Stock from Stock Edit Page when Sales Channel assigned"/>
            <title value="Cannot Delete Stock from Stock Edit Page when Sales Channel assigned"/>
            <description value="You should not be able to delete a Stock fro Stock Edit Page when a Sales Channel is assigned."/>
            <testCaseId value="950"/>
            <severity value="CRITICAL"/>
            <group value="msi"/>
        </annotations>

        <before>
            <createData entity="BasicMsiStock1" stepKey="createStock1"/>
            <createData entity="customWebsite" stepKey="createWebsite1"/>
            <!-- todo temporary solution as it is impossible to parse website_id from the post request and as a consequence can not create store group via post-->
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin1"/>
            <actionGroup ref="AdminCreateStoreGroupActionGroup" stepKey="createStoreGroup">
                <argument name="Website" value="customWebsite"/>
            </actionGroup>
            <actionGroup ref="AdminCreateStoreViewActionGroup" stepKey="createStoreView">
                <argument name="StoreGroup" value="customStoreGroupCustomWebsite"/>
            </actionGroup>
        </before>
        <after>
            <!-- todo temporary solution as it is impossible to parse website_id from the post request and as a consequence can not delete it via post-->
            <actionGroup ref="DeleteCustomWebsiteActionGroup" stepKey="DeleteWebsite">
                <argument name="websiteName" value="$$createWebsite1.website[name]$$"/>
            </actionGroup>
            <actionGroup ref="logout" stepKey="logoutOfAdmin1"/>
        </after>

        <amOnPage url="{{AdminManageStockPage.url}}" stepKey="amOnTheStocksListPage1"/>
        <waitForPageLoad time="30" stepKey="waitForPageLoad1"/>
        <actionGroup ref="searchAdminDataGridByKeyword" stepKey="searchByKeyword1">
            <argument name="keyword" value="$$createStock1.stock[name]$$"/>
        </actionGroup>
        <click selector="{{AdminGridRow.editByValue($$createStock1.stock[name]$$)}}" stepKey="clickOnEditForDefaultStock2"/>
        <waitForPageLoad time="30" stepKey="waitForPageLoad2"/>
        <selectOption selector="{{AdminEditStockSalesChannelsSection.websites}}" userInput="{{customWebsite.name}}" stepKey="SelectWebsiteAsSalesChannel"/>
        <waitForPageLoad time="10" stepKey="waitForPageLoad3"/>

        <see userInput="Delete" selector="{{AdminEditStockActionsSection.delete}}" stepKey="seeDeleteButton"/>
        <click selector="{{AdminGridMainControls.saveAndContinue}}" stepKey="saveStock1"/>
        <dontSee userInput="Delete" selector="{{AdminEditStockActionsSection.delete}}" stepKey="dontSeeDeleteButton"/>
    </test>
</tests>
